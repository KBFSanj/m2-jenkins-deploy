---
- name: Standup M2 Demo Store
  hosts: all
  remote_user: root
  vars:
    letsencrypt_email: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      30613535333761393636346531666366626263333636343464336434366631323163306533646662
      3937653937313763343562346535316363653062376439390a353961613864393165306631646139
      64663233623333636266636661646338396565376235653737653835333036636334633438343535
      3264383434666538300a353137376336366237313934353137313330633666333665376532613566
      6463
    hostname: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      30616262383130326237393365326362396132353130363434613530333139643234656437343138
      6361353832643138623963306464396132623235663130310a336632363364383933666435623932
      33343239303062396639343333373461663464633662633738656564303262393433373432333535
      3936663938303036340a643864643364663635323039653134353533623065336232626138333034
      63393565343035323339303536373562336334303435633661653333393861633665
    admin_route: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63373165383436643931333637366532613364356165336433643137346532326333643235366431
      6537396231363737353735306266656464363763653762340a303536663336626134643638636165
      33346366336161626161376163323032633838383539336163633865363434663865366163303733
      3063383162313135640a393865626230363163616634313333616430326165313037666433633734
      3238
    mage_mode: production
    crypt_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65616530326233386535363362353963636361633231336364623731363361393739303435633430
      3633633431653964393863363031663234616461636632300a336536343932376237623536656462
      39653662373039343766663539326161643237653738363135346639616561373536323034626165
      3733626262396463610a376266613864633061346636653335626430313433326530343836636162
      66386234393535643236626562613364643766303439626262653566353963656661316662643266
      3563656637316365326630343637636639343338633466383365
    docker_name_php: m2demo_php
    php_port: 8099
    backend_port: 8081

    newrelic_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      62653339323464353331646238633331646565636661343064636262313139356538356662323334
      6535613664333864323637336636333261616566313637610a356461626138663630656366653162
      32323466323836316131663435363566653933303966633835373862306438323739656332393937
      6235313564633536330a326165303962633033656263303236323035313030643265323064666338
      38323362393863643362613964613337656164646361353935656238636139626635386531336161
      3262363961663334613138633238393565643164653665666331
    newrelic_app_name: m2demo

    amqp_host: m2demo_rabbitmq
    amqp_port: 5672
    amqp_user: guest
    amqp_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      64323966353265363034373836666637656661626431643663343063656630633232333632663362
      3864333262386435663361616165353837313631386231610a643038356261643665313933653162
      66373364373766663863336238616361656234303137316664376230396365363961376663326439
      3565333331343735380a623639646232376461613966613665373737353330623362363864313130
      3962
    amqp_virtualhost: /
    docker_name_amqp: m2demo_rabbitmq

    db_host: m2demo_db
    db_port: 3306
    db_name: m2demo
    db_user: magento
    db_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      33323139363138343131393434333938663161313135303130333538316639353263636533323430
      3039633865613533646135356435346363323737653266620a633235316562663635613930386131
      30666133656663646336373939313636613235303934653237363461396632663165366361373635
      3361383835303364350a396535376564326636393762306438613165363639636163303134383466
      31643633343861666435636433346430316564383337306261343232613666323033
    db_root_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34656564646139366665313932346139333532346538343933633035636362346462396532303164
      3563313032303162303635336265326137316164623630630a306161643330633438383562376337
      33306366376263333332666365343436663764643736383036643333666235386666636134333931
      3964316237373431660a633134316436303363623331383634393964306637626461316538663132
      32633132336232643163383765653231643866353762306166383431643761316561
    docker_name_db: m2demo_db

    cache_host: m2demo_cache
    cache_port: 6379
    cache_database: 0
    docker_name_cache: m2demo_cache

    session_host: m2demo_session
    session_port: 6479
    session_database: 0
    docker_name_session: m2demo_session

    varnish_host: 127.0.0.1
    varnish_port: 6081
    docker_name_varnish: m2demo_varnish

    elasticsearch_engine: elasticsearch7
    elasticsearch_host: m2demo_elasticsearch
    elasticsearch_port: 9200
    elasticsearch_index_prefix: m2demo
    docker_name_elasticsearch: m2demo_elasticsearch

    ansistrano_deploy_from: "{{ playbook_dir }}/../build/"
    ansistrano_deploy_to: "/var/www/vhosts/m2demo.pmclain.com"
    ansistrano_version_dir: "releases"
    ansistrano_current_dir: "current"
    ansistrano_current_via: "symlink"
    ansistrano_keep_releases: 3

    ansistrano_shared_paths:
      - var
      - pub/media
    ansistrano_shared_files:
      - app/etc/env.php

    ansistrano_ensure_shared_paths_exist: yes
    ansistrano_ensure_basedirs_shared_files_exist: yes

    ansistrano_deploy_via: "rsync"

    ansistrano_allow_anonymous_stats: no

    ansistrano_before_symlink_shared_tasks_file: "{{ playbook_dir }}/m2-tasks/before-symlink-shared.yml"
    ansistrano_before_symlink_tasks_file: "{{ playbook_dir }}/m2-tasks/before-symlink.yml"
    ansistrano_after_symlink_tasks_file: "{{ playbook_dir }}/m2-tasks/after-symlink.yml"
  roles:
    - pmclain.MAGENTO2
    - ansistrano.deploy
